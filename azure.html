<!DOCTYPE html>
<html>

<head>
    <title>Speech Sample</title>
    <meta charset="utf-8" />
    <link rel= "stylesheet" href="azure.css">
</head>

<body>

  <div id="warning">
    <h1 style="font-weight:500;">Speech Recognition Speech SDK not found
        (microsoft.cognitiveservices.speech.sdk.bundle.js missing).</h1>
</div>
<div>
  <h1>Azure Options</h1>
</div>
<div id="content" style="display:none">
    <table cellspacing="20" id= "optionsTable">
        <tr>
            <td>Subscription</td>
            <td><input id="key" type="text" size="40" placeholder="Enter Your Subscription Key"></td>
        </tr>
        
        <tr>
            <td >Region</td>
            <td >
                <select id="regionOptions" class = "dropdown">
                    <option value="northcentralus" selected="selected">North Central US</option>
                    <option value="westus" >West US</option>
                    <option value="westus2">West US2</option>
                    <option value="eastus">East US</option>
                    <option value="eastus2">East US2</option>
                    <option value="eastasia">East Asia</option>
                    <option value="southeastasia">South East Asia</option>
                    <option value="northeurope">North Europe</option>
                    <option value="westeurope">West Europe</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>Language</td>
            <td>
                <!-- For the full list of supported languages see: https://docs.microsoft.com/azure/cognitive-services/speech-service/supported-languages -->
                <select id="languageOptions" class = "dropdown">
                    <option value="ar-EG">Arabic - EG</option>
                    <option value="ca-ES">Catalan - ES</option>
                    <option value="da-DK">Danish - DK</option>
                    <option value="da-DK">Danish - DK</option>
                    <option value="de-DE">German - DE</option>
                    <option value="en-AU">English - AU</option>
                    <option value="en-CA">English - CA</option>
                    <option value="en-GB">English - GB</option>
                    <option value="en-IN">English - IN</option>
                    <option value="en-NZ">English - NZ</option>
                    <option value="en-US" selected="selected">English - US</option>
                    <option value="es-ES">Spanish - ES</option>
                    <option value="es-MX">Spanish - MX</option>
                    <option value="fi-FI">Finnish - FI</option>
                    <option value="fr-CA">French - CA</option>
                    <option value="fr-FR">French - FR</option>
                    <option value="hi-IN">Hindi - IN</option>
                    <option value="it-IT">Italian - IT</option>
                    <option value="ja-JP">Japanese - JP</option>
                    <option value="ko-KR">Korean - KR</option>
                    <option value="nb-NO">Norwegian - NO</option>
                    <option value="nl-NL">Dutch - NL</option>
                    <option value="pl-PL">Polish - PL</option>
                    <option value="pt-BR">Portuguese - BR</option>
                    <option value="pt-PT">Portuguese - PT</option>
                    <option value="ru-RU">Russian - RU</option>
                    <option value="sv-SE">Swedish - SE</option>
                    <option value="zh-CN">Chinese - CN</option>
                    <option value="zh-HK">Chinese - HK</option>
                    <option value="zh-TW">Chinese - TW</option>
                </select>
            </td>
        </tr>
        
    
        <tr>
            <td align="right">Record</td>
            <td>
                <button id="speechsdkStartContinuousRecognition" class= "record-btn"></button>
                <button id="speechsdkStopContinuousRecognition" class = "stop-btn" disabled="disabled">Stop</button>
            </td>
        </tr>
        
        
    
    </table>
    <!-- <div class ="right-div">
        <button onclick="hideMenu()"> Hide</button></div>
</div> -->

    <div>
        
        <textarea id="phraseDiv"></textarea>
    </div>

    <!-- Speech SDK REFERENCE -->
    <script src="microsoft.cognitiveservices.speech.sdk.bundle.js"></script>

    <!-- Speech Speech SDK Authorization token -->
    <script>
        // Note: Replace the URL with a valid endpoint to retrieve
        //       authorization tokens for your subscription.

        // An authorization token is a more secure method to authenticate for a browser deployment as
        // it allows the subscription keys to be kept secure on a server and a 10 minute use token to be
        // handed out to clients from an endpoint that can be protected from unauthorized access.
        var authorizationEndpoint;

         //added function to set authorizationEndpoint to value put in
        function authoFunction() {
        authorizationEndpoint = document.getElementById("endpointautho").value;
        document.getElementById("displayEndpoint").innerHTML = authorizationEndpoint;
        }

        function RequestAuthorizationToken() {
            if (authorizationEndpoint) {
                var a = new XMLHttpRequest();
                a.open("GET", authorizationEndpoint);
                a.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                a.send("");
                a.onload = function () {
                    var token = JSON.parse(atob(this.responseText.split(".")[1]));
                    regionOptions.value = token.region;
                    authorizationToken = this.responseText;
                    key.disabled = true;
                    key.value = "using authorization token (hit F5 to refresh)";
                    console.log("Got an authorization token: " + token);
                }
            }
        }
    </script>

    <!-- Speech SDK USAGE -->
    <script>
        // On document load resolve the Speech SDK dependency
        function Initialize(onComplete) {
            if (!!window.SpeechSDK) {
                document.getElementById('content').style.display = 'block';
                document.getElementById('warning').style.display = 'none';
                onComplete(window.SpeechSDK);
            }
        }
    </script>

    <!-- Browser Hooks -->
    <script>
        var phraseDiv;
        var key, authorizationToken;
        var regionOptions;
        var SpeechSDK;
        var lang;

        var reco;
        var sdkStartContinousRecognitionBtn, sdkStopContinousRecognitionBtn;


        var soundContext = undefined;
        try {
            var AudioContext = window.AudioContext // our preferred impl
                || window.webkitAudioContext       // fallback, mostly when on Safari
                || false;                          // could not find.

            if (AudioContext) {
                soundContext = new AudioContext();
            } else {
                alert("Audio context not supported");
            }
        }
        catch (e) {
            window.console.log("no sound context found, no audio output. " + e);
        }

        document.addEventListener("DOMContentLoaded", function () {
            sdkStartContinousRecognitionBtn = document.getElementById("speechsdkStartContinuousRecognition");
            sdkStopContinousRecognitionBtn = document.getElementById("speechsdkStopContinuousRecognition");
            phraseDiv = document.getElementById("phraseDiv");
            key = document.getElementById("key");
            regionOptions = document.getElementById("regionOptions");
            lang = document.getElementById("languageOptions");
            


            // Starts continuous speech recognition.
            sdkStartContinousRecognitionBtn.addEventListener("click", function () {
                phraseDiv.innerHTML = "";
                var lastRecognized = "";

                // If an audio file was specified, use it. Else use the microphone.
                // Depending on browser security settings, the user may be prompted to allow microphone use. Using continuous recognition allows multiple
                // phrases to be recognized from a single use authorization.
                var audioConfig  = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();


                var speechConfig;
                if (authorizationToken) {
                    speechConfig = SpeechSDK.SpeechConfig.fromAuthorizationToken(authorizationToken, regionOptions.value);
                } else {
                    if (key.value === "" || key.value === "YOUR_SPEECH_API_KEY") {
                        alert("Please enter your Cognitive Services Speech subscription key!");
                        return;
                    }
                    speechConfig = SpeechSDK.SpeechConfig.fromSubscription(key.value, regionOptions.value);
                }

                speechConfig.speechRecognitionLanguage = lang.value;
                reco = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);

                // Before beginning speech recognition, setup the callbacks to be invoked when an event occurs.

                // The event recognizing signals that an intermediate recognition result is received.
                // You will receive one or more recognizing events as a speech phrase is recognized, with each containing
                // more recognized speech. The event will contain the text for thes recognition since the last phrase was recognized.
                reco.recognizing = function (s, e) {
                    window.console.log(e);
                    phraseDiv.innerHTML = lastRecognized + e.result.text;
                };

                // The event recognized signals that a final recognition result is received.
                // This is the final event that a phrase has been recognized.
                // For continuous recognition, you will get one recognized event for each phrase recognized.
                reco.recognized = function (s, e) {
                    window.console.log(e);

                    // Indicates that recognizable speech was not detected, and that recognition is done.
                    if (e.result.reason === SpeechSDK.ResultReason.NoMatch) {
                        var noMatchDetail = SpeechSDK.NoMatchDetails.fromResult(e.result);
                    }

                    lastRecognized += e.result.text + "\r\n";
                    phraseDiv.innerHTML = lastRecognized;
                };

                

                // Signals the end of a session with the speech service.
                reco.sessionStopped = function (s, e) {
                    window.console.log(e);
                    sdkStartContinousRecognitionBtn.disabled = false;
                    sdkStopContinousRecognitionBtn.disabled = true;
                };


                // Starts recognition
                reco.startContinuousRecognitionAsync();

                sdkStartContinousRecognitionBtn.disabled = true;
                sdkStopContinousRecognitionBtn.disabled = false;
            });

            // Stops recognition and disposes of resources.
            sdkStopContinousRecognitionBtn.addEventListener("click", function () {
                reco.stopContinuousRecognitionAsync(
                    function () {
                        reco.close();
                        reco = undefined;
                    },
                    function (err) {
                        reco.close();
                        reco = undefined;
                    });

                sdkStartContinousRecognitionBtn.disabled = false;
                sdkStopContinousRecognitionBtn.disabled = true;
            });

            

            // Demonstrates recognizing a single spoken phrase.
           

            

            Initialize(function (speechSdk) {
                SpeechSDK = speechSdk;
                sdkStartContinousRecognitionBtn.disabled = false;

                // in case we have a function for getting an authorization token, call it.
                if (typeof RequestAuthorizationToken === "function") {
                    RequestAuthorizationToken();
                }
            });
        });
    </script>



<script>

function hideMenu() {
    var x = document.getElementById("optionsTable");
    if(x.style.display == "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}


</script>
</body>

</html>